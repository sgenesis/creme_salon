<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acceder | CrÃªme Nails</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<style>
  :root {
    --primary: #4D3A33;
    --bg: #FAF7F6;
    --panel: #ffffff;
    --border: #E6D7D0;
    --text: #4D3A33;
  }
  .dark {
    --bg:#1A1615;
    --panel:#241F1E;
    --border:#3A2F2C;
    --text:#E6D7D0;
  }
  body {
    background: var(--bg);
    transition: 0.3s;
  }
  .panel {
    max-width: 420px;
    width: 90%;
    margin: 40px auto;
    background: var(--panel);
    border-radius: 16px;
    padding: 26px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.08);
    border: 1px solid var(--border);
    animation: fadeIn 0.4s ease-out;
  }
  @keyframes fadeIn {
    from { opacity:0; transform: translateY(12px); }
    to { opacity:1; transform: translateY(0); }
  }

  .btn {
    background:var(--primary);
    color:#fff;
    padding:12px;
    border-radius:10px;
    width:100%;
    font-weight:600;
    transition: 0.2s;
  }
  .btn:hover { transform: translateY(-1px); opacity:0.9 }
  .btn.ghost {
    background:transparent;
    color:var(--text);
    border:1px solid var(--border);
  }

  input {
    padding:12px;
    border-radius:10px;
    border:1px solid var(--border);
    width:100%;
    outline:none;
    background:transparent;
    color:var(--text);
  }
  input:focus {
    border-color:var(--primary);
    box-shadow: 0 0 0 2px rgba(77,58,51,0.12)
  }

  .toggle-theme {
    position:absolute;
    top:18px;
    right:18px;
    width:30px;
    height:30px;
    border-radius:50%;
    border: 1px solid var(--border);
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
  }

  .avatar {
    width:44px;
    height:44px;
    border-radius:50%;
    background:var(--border);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:var(--primary);
    font-size:16px;
  }

  .error-box {
    background:#FFEBEB;
    color:#C53030;
    padding:10px;
    border-radius:8px;
    font-size:14px;
    display:none;
  }

  .btn.ghost{
    padding-top: 12px;
    margin-top: 10px;
  }
</style>

<body class="flex items-center justify-center min-h-screen relative">

  <div class="toggle-theme" onclick="toggleTheme()">ðŸŒ“</div>

  <div class="panel">

    <div class="text-center mb-6">
      <h1 class="text-2xl font-bold" style="color:var(--primary)">CrÃªme SalÃ³n</h1>
      <p class="text-sm" style="color:var(--text);opacity:0.7">Bienvenid@ de vuelta</p>
    </div>

    <div class="flex justify-between items-center mb-4">
      <h2 class="font-bold text-lg" style="color:var(--text)">Iniciar sesiÃ³n</h2>
      <div class="avatar">CN</div>
    </div>

    <div id="errorBox" class="error-box mb-3"></div>

    <form id="loginForm" class="space-y-4">

      <div>
        <label class="block font-semibold mb-1" style="color:var(--text)">Usuario o correo electrÃ³nico</label>
        <input id="username" type="text" placeholder="Tu usuario" required />
      </div>

      <div>
        <label class="block font-semibold mb-1" style="color:var(--text)">ContraseÃ±a</label>
        <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required />
      </div>

      <label class="flex items-center gap-2 text-sm" style="color:var(--text)">
        <input type="checkbox" id="remember" class="w-4 h-4">
        Recordarme
      </label>

      <button class="btn">Ingresar</button>
    </form>

    <a href="/auth/login/google-oauth2/"
      class="btn ghost flex justify-center items-center gap-2">
    <img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" width="18">
      Iniciar con Google
    </a>

    <div class="mt-6 pt-4 border-t" style="border-color:var(--border)">
      <button id="registerBtn" class="btn ghost mb-3">Crear cuenta</button>

      <div class="text-center">
        <a href="/password-reset/" class="text-sm hover:underline" style="color:var(--text)">
          Â¿Olvidaste tu contraseÃ±a?
        </a>
      </div>
    </div>

  </div>

  <script>
    const form = document.getElementById("loginForm");
    const errorBox = document.getElementById("errorBox");
    const registerBtn = document.getElementById("registerBtn");
    const remember = document.getElementById("remember");

    /* ---- THEME ---- */
    function toggleTheme(){
      document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme", document.documentElement.classList.contains("dark") ? "dark" : "light");
    }
    if(localStorage.getItem("theme")==="dark") document.documentElement.classList.add("dark");

    /* ---- REMEMBER USER ---- */
    if(localStorage.getItem("savedUser")){
      document.getElementById("username").value = localStorage.getItem("savedUser");
      remember.checked = true;
    }

    registerBtn.onclick = () => location.href = "/api/users/register-form/";

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorBox.style.display = "none";

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      try {
        const res = await fetch("/api/appointments/login/", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ username, password }),
          credentials: "include"
        });

        if (!res.ok) throw new Error("Credenciales incorrectas");

        if(remember.checked) localStorage.setItem("savedUser", username);
        else localStorage.removeItem("savedUser");

        location.href = "/api/appointments/salon-dashboard/";

      } catch (err) {
        errorBox.textContent = err.message;
        errorBox.style.display = "block";
      }
    });
  </script>

</body>
  <!-- AÃ±ade modal simple al final del body -->
<div id="cashModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg max-w-lg w-full">
    <h3 class="text-lg font-bold">Corte diario</h3>
    <div id="cashModalBody" class="mt-4"></div>
    <div class="mt-4 flex gap-2 justify-end">
      <button id="closeCashModalBtn" class="btn ghost">Cerrar</button>
    </div>
  </div>
</div>

</html>
